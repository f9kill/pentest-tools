#!/usr/bin/env bash

######################################################################
# Author      : Hugo Torres de Lima <hugotorres@protonmail.com>      #
# Date        : 2021/08/10                                           #
# License     : MIT                                                  #
# Version     : 1.0                                                  #
# Description : Script to get information from ipfire.               #
######################################################################

# ====================================================================
# Variables
# ====================================================================

VERSION='1.0'

# Colors
RED='\e[31;1m'
GREEN='\e[32;1m'
BLUE='\e[34;1m'
END='\e[m'

host="${1}"

# ====================================================================
# Checking dependencies
# ====================================================================

#which curl || echo "Required ${RED}curl${END}!";exit 1

# ====================================================================
# Check arguments
# ====================================================================

if [[ "${1}" == "" ]];then
    Example of use: $0 127.0.0.1
fi


# ====================================================================
# Check version
# ====================================================================

function __version__ {
    # version core158
    result=curl -s -o /dev/null -w "%{http_code}" "${host}/images/apple.png"
    # version core109
    result=curl -s -o /dev/null -w "%{http_code}" "${host}/include/snortupdateutility.js"

    if [[ "$result" == 200 ]];then
        ipfire_version='>= core158'
    fi
}

# ====================================================================
# Check archives
# ====================================================================

function __files__ {
    while read -r linha;do
        resp=$(curl -s -o /dev/null -w "%{http_code}" "${host}:81/cgi-bin/${linha}")

        if [[ $resp == "302" ]];then
            echo "https://${host}:444/cgi-bin/${linha}"
        fi
    done < lista.txt
}

__files__

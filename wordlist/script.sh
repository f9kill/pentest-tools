#!/bin/bash

VERMELHO='\e[31;1m'
VERDE='\e[32;1m'
AMARELO='\e[33;1m'
ROXO='\e[34;1m'
ROSA='\e[35;1m'
END='\e[m'

file301=$VERDE
file200=$VERMELHO

VASIO="                        "
URL='https://github.com/ipfire/ipfire-2.x/tree/master/html'

function __clear__ {
    rm -rf page.html temp*
}

function __download__ {
    echo "${1}"
    wget -c -q -O page.html "${1}"
}

function __filtro__ {
    grep "<span class=" page.html | grep "title=" > temp1
    sed -i 's/ /\n/g' temp1
    grep 'title=' temp1 > temp2
    cut -d '"' -f 2 temp2 > temp3
    grep -ve "[;<>=#&]" temp3 > temp4
    sort temp4 | uniq >> file.txt
    __clear__
}

function __nivel1__ {
    cp file.txt nivel1

    while read -r lin1;do
        resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1})
        if [[ "$resp" == "404" ]];then
            echo -ne "\r${URL}/${lin1}${VASIO}";echo -ne "\r"
            continue
        fi
        __download__ ${URL}/${lin1}
        __filtro__
    done < nivel1
}

function __nivel2__ {
    cp file.txt nivel1
    cp file.txt nivel2

    while read -r lin1;do
        resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1})
        if [[ "$resp" == "404" ]] || [[ "$resp" == "301" ]];then
            echo -ne "\r${URL}/${lin1}${VASIO}";echo -ne "\r"
            resp=0
            continue
        else
            while read -r lin2;do
                resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1}/${lin2})
                if [[ "$resp" == "404" ]];then
                    echo -ne "\r${URL}/${lin1}/${lin2}${VASIO}";echo -ne "\r"
                    resp=0
                    continue
                else
                    __download__ "${URL}/${lin1}/${lin2}"
                    __filtro__
                fi
            done < nivel2
        fi
    done < nivel1
}

function __nivel3__ {
echo -e ${AMARELHO}
    cp file.txt nivel1
    cp file.txt nivel2
    cp file.txt nivel3

    while read -r lin1;do
        resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1})
        if [[ "$resp" == "404" ]] || [[ "$resp" == "301" ]];then
            echo -ne "\r${URL}/${lin1}${VASIO}";echo -ne "\r"
            resp=0
            continue
        else
            while read -r lin2;do
                resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1}/${lin2})
                if [[ "$resp" == "404" ]] || [[ "$resp" == "301" ]];then
                    echo -ne "\r${URL}/${lin1}/${lin2}${VASIO}";echo -ne "\r"
                    resp=0
                    continue
                else
                    while read -r lin3;do
                        resp=$(curl -k -s -o /dev/null -w "%{http_code}" ${URL}/${lin1}/${lin2}/${lin3})
                        if [[ "$resp" == "404" ]];then
                            echo -ne "\r${URL}/${lin1}/${lin2}/${lin3}${VASIO}";echo -ne "\r"
                            resp=0
                            continue
                        else
                            __download__ ${URL}/${lin1}/${lin2}/${lin3}
                            __filtro__
                        fi
                    done < nivel3
                fi
            done < nivel2
        fi
    done < nivel1
}


# ====================================================

__download__ ${URL}
__filtro__
__nivel1__
__nivel2__
__nivel3__
__clear__
rm nivel*

echo "               !!! SCAN COMPLETO !!!"

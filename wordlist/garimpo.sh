#!/usr/bin/env bash

function __clear__ {
    rm -rf temp
}

function __download__ {
    link="$1"
    echo "$link"
    wget -c -q -O page.html "${link}"
}

function __filtro__ {
    grep "<span class=" page.html | \
    tr ' ' '\n' |                   \
    grep "href" | grep "a>" |       \
    cut -d '"' -f 2 | sort | uniq > temp-filtro.txt
}

function __separa__ {
    while read -r linha;do
        resp=$(curl -k -s -o /dev/null -w "%{http_code}" "${URL}/${linha}")

        if [[ "${resp}" == "200" ]];then
            echo "${linha}" >> dir.txt
        elif [[ "${resp}" == "301" ]];then
            echo "${linha}" >> arq.txt
        fi
    done < temp-filtro.txt
}

function __main__ {
    __download__ "${URL}"
    __filtro__
    __separa__

    while read -r linha;do
        __download__ "${GIT}/${linha}"
        __filtro__
        __separa__
    done < dir.txt
}

# ---------------------------

URL="${1}"
GIT="https://github.com"
__main__
